schemaVersion: "2.0.0"

commandTests:
  - name: "nix is available"
    command: "/nix/var/nix/profiles/default/bin/nix"
    args: ["--version"]
    expectedOutput: ["nix \\(Nix\\)"]

  - name: "kubectl is present in store"
    command: "bash"
    args: ["-lc", "$(find /nix/store -maxdepth 3 -path '*/bin/kubectl' \\( -type f -o -type l \\) 2>/dev/null | head -1) version --client"]
    expectedOutput: ["Client Version"]

  - name: "helm is present in store"
    command: "bash"
    args: ["-lc", "$(find /nix/store -maxdepth 3 -path '*/bin/helm' \\( -type f -o -type l \\) 2>/dev/null | head -1) version"]
    expectedOutput: ["Version:"]

  # Negative: no other shell tools
  - name: "k8s variant does NOT contain python3"
    command: "bash"
    args: ["-lc", "! find /nix/store -maxdepth 3 -path '*/bin/python3' \\( -type f -o -type l \\) 2>/dev/null | grep -q ."]
    exitCode: 0

  - name: "k8s variant does NOT contain go"
    command: "bash"
    args: ["-lc", "! find /nix/store -maxdepth 3 -path '*/bin/go' \\( -type f -o -type l \\) 2>/dev/null | grep -q ."]
    exitCode: 0

  - name: "k8s variant does NOT contain java"
    command: "bash"
    args: ["-lc", "! find /nix/store -path '*/bin/java' \\( -type f -o -type l \\) 2>/dev/null | grep -q ."]
    exitCode: 0
